platform :ios do
  lane :build_capacitor do
    # Force the provisioning profile directly into the target â€” Appflow cannot ignore this
    update_project_provisioning(
      xcodeproj: "ios/App/App.xcodeproj",
      target_filter: "App",
      build_configuration: "Release",
      profile: ENV["SIGH_PROFILE_PATH"]
    )

    # Hammer it again with sed directly into the project file
    sh "sed -i '' 's/PROVISIONING_PROFILE_SPECIFIER = \\\"\\\"/PROVISIONING_PROFILE_SPECIFIER = \\\"Krittics App Store Profile\\\"/g' ios/App/App.xcodeproj/project.pbxproj"
    sh "sed -i '' 's/PROVISIONING_PROFILE = \\\"\\\"/PROVISIONING_PROFILE = \\\"\\\"/g' ios/App/App.xcodeproj/project.pbxproj || true"
  end
end
